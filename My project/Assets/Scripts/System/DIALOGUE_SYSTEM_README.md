# Система диалогов с событийными триггерами

## Обзор изменений

Система диалогов была обновлена для поддержки:
1. **Множественных строк** - диалог может состоять из нескольких строк, переход между которыми осуществляется кликом ЛКМ
2. **Событийных триггеров** - диалоги могут ждать определенных событий перед продолжением

## Структура JSON диалогов

### Новый формат:
```json
{
  "dialogues": [
    {
      "dialogueID": "room1_birth_start",
      "speaker": "Инструктор",
      "typingSpeed": 0.05,
      "audioClip": "type_slow",
      "lines": [
        {
          "text": "Первая строка диалога",
          "typingSpeed": 0.05
        },
        {
          "text": "Вторая строка диалога",
          "waitForEvent": "MouseMoved",
          "typingSpeed": 0.05
        }
      ]
    }
  ]
}
```

### Параметры DialogueLine:
- `text` - текст строки (обязательно)
- `speaker` - имя говорящего (опционально, переопределяет speaker из DialogueEntry)
- `typingSpeed` - скорость печати (опционально, использует значение из DialogueEntry)
- `audioClip` - звук печати (опционально, использует значение из DialogueEntry)
- `waitForEvent` - имя события, которое нужно дождаться перед показом этой строки (опционально)

## Доступные события

### События движения и ввода:
- `MouseMoved` - движение мыши
- `KeyPressed_LeftShift` - нажатие Shift
- `KeyPressed_LeftControl` - нажатие Ctrl
- `KeyPressed_Space` - нажатие Space
- `KeyPressed_E` - нажатие E
- `KeyPressed_1` - нажатие 1
- `KeyPressed_W`, `KeyPressed_A`, `KeyPressed_S`, `KeyPressed_D` - нажатие WASD

### События взаимодействия:
- `DoorOpened` - открытие двери
- `ObjectPickedUp` - подбор предмета
- `ObjectPickedUp_[имя_предмета]` - подбор конкретного предмета

### События оружия:
- `WeaponDrawn` - доставание оружия (клавиша 1)
- `WeaponFired` - выстрел
- `TargetHit` - попадание в мишень
- `ObjectDestroyedByShot` - разрушение объекта выстрелом

## Использование

### 1. Добавьте EventManager в сцену
Создайте пустой GameObject и добавьте компонент `EventManager` (из папки `Scripts/System`).

### 2. Добавьте InputEventTracker (опционально)
Для автоматического отслеживания нажатий клавиш добавьте компонент `InputEventTracker` на любой GameObject в сцене.

### 3. Настройка разрушаемых объектов
Для объектов, которые должны разрушаться выстрелом:
- Добавьте компонент `DestructibleObject`
- ИЛИ установите тег `Destructible` или `Target`

### 4. Использование в диалогах
В JSON файле диалога укажите `waitForEvent` в нужной строке:
```json
{
  "text": "Покрути головой...",
  "waitForEvent": "MouseMoved"
}
```

## Примеры JSON файлов

Созданы примеры для:
- `room1_birth.json` - Комната 1: Рождение
- `room2_infancy.json` - Комната 2: Младенчество
- `room3_childhood.json` - Комната 3: Детство
- `room4_weapon.json` - Комната 4: Оружие

## Управление в диалогах

- **ЛКМ (левая кнопка мыши)** - переход к следующей строке или закрытие диалога (если это последняя строка)
- Во время печати текста можно кликнуть ЛКМ, чтобы сразу показать полный текст строки

## Обратная совместимость

Старый формат диалогов (с полем `text` напрямую в `DialogueEntry`) все еще поддерживается и автоматически конвертируется в новый формат.

